# .pre-commit-config.yaml
# Zero-Trust Security Hooks — FAANG/NSA Level
# Blocks merge on any secret, vuln, license violation

repos:
  # 1. Gitleaks — Detect hardcoded secrets (AWS keys, tokens, etc.)
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.21.1
    hooks:
      - id: gitleaks
        name: "[Security] Detect secrets (Gitleaks)"
        stages: [commit, push]
        verbose: true

  # 2. Trivy — Filesystem vulnerability scanner
  - repo: https://github.com/aquasecurity/trivy
    rev: v0.58.0
    hooks:
      - id: trivy-fs
        name: "[Security] Trivy FS scan (vulns in scripts/docker)"
        args: [--quiet, --exit-code, 1, --no-progress, --format, sarif, --output, trivy-fs.sarif]
        stages: [commit]

  # 3. Semgrep — SAST for Bash, YAML, JSON, Terraform
  - repo: https://github.com/returntocorp/semgrep
    rev: v1.95.0
    hooks:
      - id: semgrep
        name: "[Security] Semgrep SAST (bash, secrets, crypto)"
        args: [--config=p/ci, --config=p/secrets, --config=p/bash, --error, --verbose]

  # 4. Syft — Generate SBOM (Software Bill of Materials)
  - repo: https://github.com/anchore/syft
    rev: v1.14.0
    hooks:
      - id: syft-sbom
        name: "[SBOM] Generate CycloneDX SBOM"
        args: [dir:., --output, cyclonedx-json=sbom.json]

  # 5. Grype — Scan SBOM for vulnerabilities
  - repo: https://github.com/anchore/grype
    rev: v0.85.0
    hooks:
      - id: grype-scan
        name: "[SBOM] Scan SBOM with Grype"
        args: [sbom:sbom.json, --fail-on, high, --output, sarif, --file, grype.sarif]

  # 6. Flawfinder — C/C++ vulns (if any)
  - repo: https://github.com/david-a-wheeler/flawfinder
    rev: v2.0.19
    hooks:
      - id: flawfinder
        name: "[Security] Flawfinder (C/C++ vulns)"

  # 7. Licensee — License compliance
  - repo: https://github.com/github/licensee
    rev: v9.17.0
    hooks:
      - id: detect-licenses
        name: "[License] Block GPL/AGPL"
        args: [--block, GPL, AGPL, CC-BY-NC]

  # 8. ShellCheck — Static analysis
  - repo: local
    hooks:
      - id: shellcheck
        name: "[Lint] ShellCheck (zero warnings)"
        entry: shellcheck
        language: system
        types: [shell]
        args: [--severity=error, --external-sources]

  # 9. Shfmt — Auto-format Bash
  - repo: https://github.com/mvdan/sh
    rev: v3.8.0
    hooks:
      - id: shfmt
        name: "[Format] Shfmt (Google style)"
        args: [-w, -i, 2, -ci]

  # 10. Check added large files
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      - id: check-added-large-files
        name: "[Policy] No files >500KB"
        args: [--maxkb=500]

  # 11. Detect private keys
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      - id: detect-private-key
        name: "[Security] No private keys"

  # 12. Trailing whitespace & EOF
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
