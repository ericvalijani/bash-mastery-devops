# .github/workflows/security.yaml
name: Security Scan

on:
  push:
    paths:
      - 'scripts/**/*.sh'
      - 'lib/**/*.sh'
  pull_request:

jobs:
  shellcheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install ShellCheck
        run: sudo apt-get install -y shellcheck
      - name: Run ShellCheck
        run: shellcheck scripts/advanced/day11/*.sh lib/*.sh
      - name: Run ShellCheck with cross-file analysis
        run: |
          shellcheck -x \
            scripts/advanced/day11/*.sh \
            lib/*.sh

  secrets-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Gitleaks
        run: |
          curl -sSfL https://github.com/zricethezav/gitleaks/releases/download/v8.18.4/gitleaks_8.18.4_linux_x64.tar.gz | tar -xz
          sudo mv gitleaks /usr/local/bin/
      - name: Scan for secrets
        run: gitleaks detect --no-git --source . --verbose || echo "Secrets found!"
